"use strict";(self.webpackChunkdt_react_component=self.webpackChunkdt_react_component||[]).push([[1649],{1649:function(it,Te,m){m.d(Te,{Y:function(){return Se},Z:function(){return Xe}});var at=m(59375),Me=m(91730),Pe=m(13448),se=m.n(Pe),be=m(74815),ge=m.n(be),De=m(77117),ne=m.n(De),Ie=m(28152),Re=m.n(Ie),$=m(50959),Ge=m(15033),Ae=m.n(Ge),Ve=m(96345),Ne=m.n(Ve),Oe=m(21320),X=m.n(Oe),He=m(45972),ze=m.n(He),ce=function(){function v(){var T=this;Ae()(this,v),X()(this,"layoutEventHandler",function(){}),X()(this,"mxInstance",void 0),X()(this,"mxGraph",null),X()(this,"getDefaultVertexStyle",function(){var u=T.mxInstance,e=u.mxConstants,y=u.mxPerimeter,l=[];return l[e.STYLE_SHAPE]=e.SHAPE_RECTANGLE,l[e.STYLE_PERIMETER]=y.RectanglePerimeter,l[e.STYLE_ALIGN]=e.ALIGN_CENTER,l[e.STYLE_VERTICAL_ALIGN]=e.ALIGN_MIDDLE,l[e.STYLE_FONTSIZE]="12",l[e.STYLE_FONTFAMILY]="PingFangSC-Regular",l[e.FONT_BOLD]="normal",l[e.STYLE_WHITE_SPACE]="nowrap",l[e.STYLE_FONTSTYLE]=1,l}),X()(this,"getDefaultEdgeStyle",function(){var u=T.mxInstance,e=u.mxConstants,y=u.mxEdgeStyle,l=[];return l[e.STYLE_SHAPE]=e.SHAPE_CONNECTOR,l[e.STYLE_STROKECOLOR]="#3f87ff",l[e.STYLE_STROKEWIDTH]=1,l[e.STYLE_ALIGN]=e.ALIGN_CENTER,l[e.STYLE_VERTICAL_ALIGN]=e.ALIGN_MIDDLE,l[e.STYLE_EDGE]=y.TopToBottom,l[e.STYLE_ENDARROW]=e.ARROW_BLOCK,l[e.STYLE_FONTSIZE]="10",l[e.STYLE_ROUNDED]=!1,l}),X()(this,"initContainerScroll",function(){var u=T.mxInstance,e=u.mxRectangle,y=u.mxPoint,l=u.mxUtils;if(T.mxGraph){var o=T.mxGraph;o.scrollTileSize=new e(0,0,200,200),o.getPagePadding=function(){return new y(Math.max(0,Math.round(o.container.offsetWidth-34)),Math.max(0,Math.round(o.container.offsetHeight-34)))},o.getPageSize=function(){return this.pageVisible?new e(0,0,this.pageFormat.width*this.pageScale,this.pageFormat.height*this.pageScale):this.scrollTileSize},o.getPageLayout=function(){var i=this.pageVisible?this.getPageSize():this.scrollTileSize,c=this.getGraphBounds();if(c.width===0||c.height===0)return new e(0,0,1,1);var P=Math.ceil(c.x/this.view.scale-this.view.translate.x),Y=Math.ceil(c.y/this.view.scale-this.view.translate.y),k=Math.floor(c.width/this.view.scale),N=Math.floor(c.height/this.view.scale),b=Math.floor(P/i.width),f=Math.floor(Y/i.height),B=Math.ceil((P+k)/i.width)-b,W=Math.ceil((Y+N)/i.height)-f;return new e(b,f,B,W)},o.view.getBackgroundPageBounds=function(){var i=this.graph.getPageLayout(),c=this.graph.getPageSize();return new e(this.scale*(this.translate.x+i.x*c.width),this.scale*(this.translate.y+i.y*c.height),this.scale*i.width*c.width,this.scale*i.height*c.height)},o.getPreferredPageSize=function(){var i=this.getPageLayout(),c=this.getPageSize();return new e(0,0,i.width*c.width,i.height*c.height)};var _=o.view.validate;o.view.validate=function(){if(this.graph.container!=null&&l.hasScrollbars(this.graph.container)){var i=this.graph.getPagePadding(),c=this.graph.getPageSize();this.translate.x=i.x/this.scale-(this.x0||0)*c.width,this.translate.y=i.y/this.scale-(this.y0||0)*c.height}_.apply(this,arguments)};var Z=o.sizeDidChange;o.sizeDidChange=function(){if(this.container!=null&&l.hasScrollbars(this.container)){var i=this.getPageLayout(),c=this.getPagePadding(),P=this.getPageSize(),Y=Math.ceil(2*c.x/this.view.scale+i.width*P.width),k=Math.ceil(2*c.y/this.view.scale+i.height*P.height),N=o.minimumGraphSize;(N===null||N.width!==Y||N.height!==k)&&(o.minimumGraphSize=new e(0,0,Y,k));var b=c.x/this.view.scale-i.x*P.width,f=c.y/this.view.scale-i.y*P.height;if(!this.autoTranslate&&(this.view.translate.x!==b||this.view.translate.y!==f)){this.autoTranslate=!0,this.view.x0=i.x,this.view.y0=i.y;var B=o.view.translate.x,W=o.view.translate.y;o.view.setTranslate(b,f),o.container.scrollLeft+=(b-B)*o.view.scale,o.container.scrollTop+=(f-W)*o.view.scale,this.autoTranslate=!1}Z.apply(this,arguments)}}}}),this.mxInstance=ze()(v.config)}return Ne()(v,[{key:"create",value:function(u,e){var y,l,o=this.mxInstance,_=o.mxGraphView,Z=o.mxText,i=o.mxGraph,c=o.mxEvent,P=o.mxConstants,Y=o.mxGraphHandler,k=o.mxSvgCanvas2D,N=o.mxClient,b=o.mxPoint;k.prototype.updateStroke=function(){var a=this.state,g=String(a.strokeColor);this.node.setAttribute("stroke",g.startsWith("const")?g:g.toLowerCase()),(a.alpha<1||a.strokeAlpha<1)&&this.node.setAttribute("stroke-opacity",a.alpha*a.strokeAlpha);var D=this.getCurrentStrokeWidth();D!==1&&this.node.setAttribute("stroke-width",D),this.node.nodeName==="path"&&this.updateStrokeAttributes(),a.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern((a.fixDash?1:a.strokeWidth)*a.scale))},k.prototype.updateFill=function(){var a=this.state;if((a.alpha<1||a.fillAlpha<1)&&this.node.setAttribute("fill-opacity",a.alpha*a.fillAlpha),a.fillColor!=null)if(a.gradientColor!=null){var g=this.getSvgGradient(String(a.fillColor),String(a.gradientColor),a.gradientFillAlpha,a.gradientAlpha,a.gradientDirection);if(!N.IS_CHROMEAPP&&!N.IS_IE&&!N.IS_IE11&&!N.IS_EDGE&&this.root.ownerDocument===document){var D=this.getBaseUrl().replace(/([()])/g,"\\$1");this.node.setAttribute("fill","url(".concat(D,"#").concat(g,")"))}else this.node.setAttribute("fill","url(#".concat(g,")"))}else{var I=String(a.fillColor);this.node.setAttribute("fill",I.startsWith("const")?I:I.toLowerCase())}},_.prototype.optimizeVmlReflows=!1,Z.prototype.ignoreStringSize=!0,Y.prototype.guidesEnabled=!0,c.disableContextMenu(u);var f=new i(u);this.mxGraph=f,f.setPanning(!0),f.panningHandler.useLeftButtonForPanning=!0,f.setTooltips((y=e==null?void 0:e.tooltips)!==null&&y!==void 0?y:!0),f.view.setScale(1),f.setHtmlLabels(!0),f.setAllowDanglingEdges(!1),f.setConnectable((l=e==null?void 0:e.connectable)!==null&&l!==void 0?l:!1),f.isCellsMovable=function(){var a=e==null?void 0:e.vertexMovable;if(a===!0||a===void 0){var g=f.getSelectionCell();return!(g&&g.edge)}return!1},f.isCellEditable=function(){return!1},f.isCellResizable=function(){return!1};var B=typeof(e==null?void 0:e.defaultVertexStyle)=="function"?e.defaultVertexStyle(this.mxInstance):e==null?void 0:e.defaultVertexStyle;f.getStylesheet().putDefaultVertexStyle(ne()(ne()({},this.getDefaultVertexStyle()),B||{}));var W=typeof(e==null?void 0:e.defaultEdgeStyle)=="function"?e.defaultEdgeStyle(this.mxInstance):e==null?void 0:e.defaultEdgeStyle;f.getStylesheet().putDefaultEdgeStyle(ne()(ne()({},this.getDefaultEdgeStyle()),W||{})),_.prototype.updateFloatingTerminalPoint=function(a,g,D,I){if(e!=null&&e.getPortOffset){var J=this.getNextPoint(a,D,I);if(!g.text)return;var le=g.text.node.getElementsByTagName("div")[1],M=g.x,Q=g.getCenterY();if(J.x>M+g.width/2&&(M+=g.width),le!=null){var K;Q=g.getCenterY()-le.scrollTop;var t=e==null||(K=e.getPortOffset)===null||K===void 0?void 0:K.call(e,a,I);t&&(Q=ae(g,t)),a!=null&&a.absolutePoints!=null&&(J.y=Q)}a.setAbsoluteTerminalPoint(new b(M,Q),I)}else a.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(a,g,D,I),I)};var ae=function(g,D){var I=D.parentNode.parentNode.parentElement,J=D.offsetTop-I.offsetTop+D.offsetHeight/2;return g.y+J};return P.HANDLE_FILLCOLOR="#ffffff",P.HANDLE_STROKECOLOR="#2491F7",P.VERTEX_SELECTION_COLOR="transparent",P.CURSOR_MOVABLE_VERTEX="pointer",P.STYLE_OVERFLOW="hidden",f}},{key:"createRubberBand",value:function(){var u=this.mxInstance.mxRubberband;if(!this.mxGraph)throw new Error("Please call create before createRubberBand");return new u(this.mxGraph)}},{key:"renderVertex",value:function(u){this.mxGraph&&(this.mxGraph.getLabel=function(e){return e&&e.vertex?u(e):""})}},{key:"renderTooltips",value:function(u){var e=this;this.mxGraph&&(this.mxGraph.getTooltipForCell=function(y){if(y&&y.vertex){var l=u(y);return l===void 0?e.mxGraph.getLabel(y):l}return""})}},{key:"setView",value:function(u){var e=u.scale,y=u.dx,l=u.dy;this.mxGraph&&(this.mxGraph.view.setScale(e),this.mxGraph.view.setTranslate(y,l))}},{key:"resetScrollPosition",value:function(){if(this.mxGraph&&this.mxGraph.container){var u=this.mxGraph,e=u.getGraphBounds(),y=Math.max(e.width,u.scrollTileSize.width*u.view.scale),l=Math.max(e.height,u.scrollTileSize.height*u.view.scale);u.container.scrollTop=Math.floor(Math.max(0,e.y-Math.max(20,(u.container.clientHeight-l)/2))),u.container.scrollLeft=Math.floor(Math.max(0,e.x-Math.max(0,(u.container.clientWidth-y)/2)))}}},{key:"dispose",value:function(){this.mxGraph&&this.mxGraph.destroy()}}]),v}();X()(ce,"config",{mxImageBasePath:"images",mxLanguage:"none",mxLoadResources:!1,mxLoadStylesheets:!1}),X()(ce,"VertexSize",{width:210,height:50});var q=ce,re=m(11527),z=new q,L=z.mxInstance,Ye=L.mxHierarchicalLayout,xe=L.mxCellHighlight,H=L.mxEvent,he=L.mxPopupMenu,ke=L.mxEventObject,pe=L.mxImage,me=L.mxUtils,Fe=L.mxDragSource,Ke=L.mxGraph,Be=L.mxShape,ue=L.mxConnectionConstraint,de=L.mxPoint,We=L.mxPolyline,Ce=L.mxConstraintHandler,je=L.mxKeyHandler,ye=L.mxClient,Se="taier__widgets",we=Symbol("draggable");function Ue(v){var T=String.fromCharCode(v);if(T==="\b")return"\u232B"}function $e(v,T){var u=v.enableDrag,e=v.loading,y=e===void 0?!1:e,l=v.style,o=v.graphData,_=v.vertexKey,Z=_===void 0?"taskId":_,i=v.vertexSize,c=v.config,P=v.direction,Y=v.children,k=v.onRenderCell,N=v.onRenderTooltips,b=v.onDrawVertex,f=v.onDrawEdge,B=v.onClick,W=v.onContextMenu,ae=v.onDoubleClick,a=v.onGetSize,g=v.onRenderWidgets,D=v.onGetPreview,I=v.onDropWidgets,J=v.onRenderActions,le=v.onKeyDown,M=v.onCellsChanged,Q=v.onContainerChanged,K=(0,$.useRef)(null),t=(0,$.useRef)(),ve=(0,$.useRef)([]),Ze=(0,$.useState)(null),Ee=Re()(Ze,2),Je=Ee[0],Le=Ee[1];(0,$.useImperativeHandle)(T,function(){return{insertCell:function(n,r,d){if(t.current){var R=(i==null?void 0:i.width)||q.VertexSize.width,G=(i==null?void 0:i.height)||q.VertexSize.height,A=b==null?void 0:b(n);t.current.insertVertex(t.current.getDefaultParent(),n[Z],n,r,d,R,G,A);var S=t.current.getDefaultParent(),p=t.current.getChildVertices(S);p.length===1&&t.current.center(!0,!0,.55,.4)}},updateCell:function(n,r){if(t.current){var d=t.current.getModel().getCell(n);d&&(d.setValue(ne()(ne()({},d.value),r)),M==null||M(d),t.current.view.refresh())}},removeCell:function(n){if(t.current){var r=t.current.getModel().getCell(n);r&&t.current.removeCells([r],!0)}},getSelectedCell:function(){return t.current?t.current.getSelectionCell():null},getCells:function(){var n,r=((n=t.current)===null||n===void 0?void 0:n.getModel().getChildCells(t.current.getDefaultParent()))||[];return r},setCells:function(n){var r;(r=t.current)===null||r===void 0||r.addCells(n)},setView:function(n){t.current&&(t.current.view.setScale(n.scale),t.current.container&&setTimeout(function(){var r;(r=t.current)===null||r===void 0||r.container.scrollTo({top:n.scrollTop,left:n.scrollLeft})},0))}}});var Qe=function(){t.current=z.create(K.current,c),z.createRubberBand(),z.renderVertex(function(n){return(k==null?void 0:k(n,t.current))||""}),z.renderTooltips(function(n){return N==null?void 0:N(n,t.current)}),z.layoutEventHandler=function(){var n=t.current.getDefaultParent();t.current.getModel().beginUpdate();try{var r=new Ye(t.current,P||"north");r.disableEdgeStyle=!1,r.interRankCellSpacing=60,r.intraCellSpacing=80,r.execute(n)}finally{t.current.getModel().endUpdate()}},z.initContainerScroll()},qe=function(){var n=document.querySelectorAll('*[class*="'.concat(Se,'"]'));n.forEach(function(r){if(!Object.hasOwnProperty(we)){var d=(D==null?void 0:D(r))||function(){var S=document.createElement("div");return S.innerHTML='<span class="preview-title">\u65B0\u8282\u70B9</span>',S}(),R=(i==null?void 0:i.width)||q.VertexSize.width,G=(i==null?void 0:i.height)||q.VertexSize.height;d.style.width="".concat(R,"px"),d.style.height="".concat(G,"px");var A=me.makeDraggable(r,function(S){var p=H.getClientX(S),h=H.getClientY(S),s=document.elementFromPoint(p,h);return s&&me.isAncestorNode(t.current.container,s)?t.current:null},function(S,p,h,s,w){S.canImportCell(h)&&(I==null||I(r,S,h,s,w))},d,void 0,void 0,t.current.autoScroll,!0);A.createPreviewElement=function(){return d},A.isGuidesEnabled=function(){return t.current.graphHandler.guidesEnabled},A.createDragElement=Fe.prototype.createDragElement,Object.defineProperty(r,we,{value:!0,writable:!1,enumerable:!1})}})},_e=function(){if(le){var n=new je(t.current);n.getFunction=function(d){return d!==null&&!H.isAltDown(d)?this.isControlDown(d)||ye.IS_MAC&&d.metaKey?H.isShiftDown(d)?this.controlShiftKeys[d.keyCode]:this.controlKeys[d.keyCode]:H.isShiftDown(d)?this.shiftKeys[d.keyCode]:this.normalKeys[d.keyCode]:null};var r=le();ve.current=r,r.forEach(function(d){var R=d.method,G=d.keyCode,A=d.func;n[R](G,function(){var S;(S=t.current)!==null&&S!==void 0&&S.isEnabled()&&A()})})}},et=function(){u&&(Ce.prototype.pointImage=new pe("images/points.gif",5,5),Ce.prototype.highlightColor="#3f87ff",Ke.prototype.getAllConnectionConstraints=function(n){if(n!=null&&n.shape){if(n.shape.stencil)return n.shape.stencil.constraints;if(n.shape.constraints)return n.shape.constraints}return[]},Be.prototype.constraints=[new ue(new de(.5,0),!0),new ue(new de(0,.5),!0),new ue(new de(1,.5),!0),new ue(new de(.5,1),!0)],We.prototype.constraints=[],t.current.connectionHandler.isConnectableCell=function(){return!1},t.current.isValidConnection=function(n,r){if(!n.vertex||!r.vertex)return!1;var d=this.getEdgesBetween(n,r);if(d.length>0)return!1;var R=!1;return this.traverse(r,!0,function(G){if(n.id===G.id)return R=!0,!1}),!R})},tt=function(){var n,r,d,R,G,A=[];(n=t.current)===null||n===void 0||n.addListener(H.ADD_CELLS,function(p,h){var s=h.getProperty("cell");M==null||M(s)}),(r=t.current)===null||r===void 0||r.addListener(H.REMOVE_CELLS,function(p,h){var s=h.getProperty("cell");M==null||M(s)}),(d=t.current)===null||d===void 0||d.addListener(H.MOVE_END,function(p,h){var s=h.getProperty("cell");M==null||M(s)}),(R=t.current)===null||R===void 0||R.addListener(H.CLICK,function(p,h){var s=h.getProperty("cell");if(Le((s==null?void 0:s.value)||null),A.forEach(function(te){return te.destroy()}),(c==null?void 0:c.highlight)===!0)if(s)if(s.vertex)for(var w,O,ie=((w=t.current)===null||w===void 0?void 0:w.getOutgoingEdges(s))||[],E=((O=t.current)===null||O===void 0?void 0:O.getIncomingEdges(s,t.current.getDefaultParent()))||[],C=ie.concat(E),F=0;F<C.length;F+=1){var ee=new xe(t.current,"#3f87ff",2),oe=t.current.view.getState(C[F]);ee.highlight(oe),A.push(ee)}else{var j=new xe(t.current,"#3f87ff",2),U=t.current.view.getState(s);j.highlight(U),A.push(j)}else{var V,fe=t.current.getSelectionCells();(V=t.current)===null||V===void 0||V.removeSelectionCells(fe)}s!=null&&s.vertex&&(B==null||B(s,t.current,h.getProperty("event")))}),(G=t.current)===null||G===void 0||G.addListener(H.DOUBLE_CLICK,function(p,h){var s=h.getProperty("cell");s&&s.vertex&&(ae==null||ae(s,t.current,h.getProperty("event")))});var S=he.prototype.showMenu;he.prototype.showMenu=function(){var p=this.graph.getSelectionCells()||[];if(p.length>0)S.apply(this,arguments);else return!1},t.current.popupMenuHandler.autoExpand=!0,he.prototype.popup=function(){var p=ge()(se()().mark(function h(s,w,O,ie){return se()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!(this.div!=null&&this.tbody!=null&&this.factoryMethod!=null)){C.next=8;break}for(this.div.style.left="".concat(s,"px"),this.div.style.top="".concat(w,"px");this.tbody.firstChild!=null;)H.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);return this.itemCount=0,C.next=7,this.factoryMethod(this,O,ie);case 7:this.itemCount>0&&(this.showMenu(),this.fireEvent(new ke(H.SHOW),[]));case 8:case"end":return C.stop()}},h,this)}));return function(h,s,w,O){return p.apply(this,arguments)}}(),t.current.collapsedImage=new pe("",0,0),t.current.popupMenuHandler.factoryMethod=function(){var p=ge()(se()().mark(function h(s,w){var O;return se()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(w){E.next=2;break}return E.abrupt("return");case 2:return E.next=4,W==null?void 0:W(w.value,w,t.current);case 4:O=E.sent,O==null||O.forEach(function(C){var F=C.id,ee=C.title,oe=C.disabled,j=C.children,U=C.callback,V=!!ve.current.length&&!!F&&ve.current.find(function(te){return te.id===F}),fe=s.addItem(V?"".concat(ee,"(").concat(function(){switch(V.method){case"bindControlKey":return ye.IS_MAC?"\u2318":"Meta";case"bindKey":default:return""}}()," ").concat(Ue(V.keyCode),")"):ee,void 0,function(){if(V){V.func();return}U==null||U()},void 0,void 0,!oe);j!=null&&j.length&&j.forEach(function(te){s.addItem(te.title,void 0,te.callback,fe,void 0,!te.disabled)})});case 6:case"end":return E.stop()}},h)}));return function(h,s){return p.apply(this,arguments)}}()},nt=function(){if(o){var n;o.length===1&&Le(o[0]);for(var r=o.map(function(R){return{sourceOrTarget:null,data:R}}),d=function(){var G,A,S=r.pop(),p=S.sourceOrTarget,h=S.data,s=b==null?void 0:b(h),w=a==null?void 0:a(h),O=(w==null?void 0:w.width)||(i==null?void 0:i.width)||q.VertexSize.width,ie=(w==null?void 0:w.height)||(i==null?void 0:i.height)||q.VertexSize.height,E=t.current.insertVertex(t.current.getDefaultParent(),h[Z],h,0,0,O,ie,s);if(p){var C,F=!!((C=p.value)!==null&&C!==void 0&&(C=C.childNode)!==null&&C!==void 0&&C.find(function(V){return V[Z]===h[Z]})),ee=F?p:E,oe=F?E:p,j=f==null?void 0:f(F?p:E,F?E:p);t.current.insertEdge(t.current.getDefaultParent(),null,null,ee,oe,j)}else{var U;(U=t.current)===null||U===void 0||U.setSelectionCell(E)}(G=h.childNode)!==null&&G!==void 0&&G.length&&h.childNode.forEach(function(V){r.push({sourceOrTarget:E,data:V})}),(A=h.parentNode)!==null&&A!==void 0&&A.length&&h.parentNode.forEach(function(V){r.push({sourceOrTarget:E,data:V})})};r.length;)d();(n=z.layoutEventHandler)===null||n===void 0||n.call(z),rt()}},rt=function(){window.setTimeout(function(){z.resetScrollPosition()},0)};return(0,$.useEffect)(function(){return Qe(),nt(),tt(),et(),qe(),_e(),function(){var x;(x=t.current)===null||x===void 0||x.destroy()}},[o]),(0,$.useEffect)(function(){var x;function n(){var r;Q==null||Q({scrollTop:K.current.scrollTop,scrollLeft:K.current.scrollLeft,scale:((r=t.current)===null||r===void 0?void 0:r.getView().getScale())||-1})}return(x=K.current)===null||x===void 0||x.addEventListener("scroll",n),function(){var r;(r=K.current)===null||r===void 0||r.removeEventListener("scroll",n)}},[]),(0,re.jsxs)("div",{className:"dtc-graph-editor",style:l,children:[(0,re.jsx)(Me.default,{tip:"Loading...",size:"large",spinning:y,wrapperClassName:"dtc-task-graph",children:(0,re.jsx)("div",{style:{position:"relative",overflow:"auto",width:"100%",height:"100%"},tabIndex:-1,ref:K})}),g&&(0,re.jsx)("div",{className:"dtc-graph-widgets",onContextMenu:function(n){return n.preventDefault()},children:g==null?void 0:g()}),(0,re.jsx)("div",{className:"dtc-graph-bottom",children:Y==null?void 0:Y(Je)}),(0,re.jsx)("div",{className:"dtc-graph-toolbar",style:c==null?void 0:c.toolbarStyle,children:J==null?void 0:J(t.current,z.mxInstance)})]})}var Xe=(0,$.forwardRef)($e)}}]);
